535c0ef0f1ace2a5
<!---- deploy info ---->
# アソシエーション：1対多

## 今回のテーマ

```
（１）１対多のアソシエーションを設定できること

（２）設定したアソシエーションを使用し、必要なデータを取得できること
```

## アソシエーションとは
```
テーブル間の関連付けをモデル上で行えるrailsの機能の一つ
```
![図１](/図１.png)

## アソシエーションを使用するメリット
```
（１）テーブル間の関連付けをモデルにメソッドを記述することで容易に設定できる。

（２）関連先のデータをメソッドのように記述することで取得できる。
```

## アソシエーションの設定

今回は、`producersテーブル`と`appsテーブル`を準備し、ある製作者が作成したアプリ情報を取得するアソシエーションを設定してみましょう。

＊図１を参考に、各自でProducerモデル、Appモデルを作成し、図１を参考にデータを登録してください。ここで`producer_id`は、`外部キー`とします。


**（１）テーブル間の関係性を把握**

まず、アソシエーションを設定しようとしているテーブル間に、どういう関係性があるのかを考えます。
この、テーブル間の関係性を把握しておかないと、`どういうアソシエーションを設定すればいいのかが不明となる`ので、きちんと押さえておきましょう。

今回の場合、製作者とアプリは、`１人の製作者は多数のアプリを作成することができ、作成したそれぞれのアプリは特定の製作者に帰属する`という関係性があると言えます。
このような関係性のことを、`１対多の関係性`と言います。

**（２）アソシエーションの設定**

`producersテーブル`と`appsテーブル`が`「１対多」`の関係性であることが分かったので、いよいよアソシエーションを設定します。

railsのアソシエーションは、設定するモデルに`「has_many」` `「belongs_to」`メソッドを記述します。
では、どのモデルにどのメソッドを記述すればいいのでしょうか。

それは（１）で考えた、`producersテーブル`と`appsテーブル`の間には、`１人の製作者は多数のアプリを作成することができ、作成したそれぞれのアプリは特定の製作者に帰属する`関係性がある、という部分がヒントになります。

ここで、`１人の製作者は多数のアプリを作成し`という表現を、`１人の製作者は多数のアプリを持つ`と読み替えます。

読み替えたことで、Producerモデルは以下のように記述できます。

```
class Producer      #製作者は
   has_many :apps   #多数のアプリを持つ
end

＊「has_many」メソッドを使用したアソシエーション名は、複数形になります。
```

次に、

`それぞれのアプリは特定の製作者に帰属します`という表現を`アプリは１人の製作者に帰属する`と読み替えます。

読み替えたことで、appモデルは以下のように記述できます。

```
class App                   #アプリは
   belongs_to :producer     #製作者に帰属する
end

＊「belongs_to」メソッドのアソシエーション名は、単数形です。
```

これで、`１対多`のアソシエーション設定は完了です。

#### チェックポイント
```
has_many:○○、belongs_to:○○で設定した○○を「アソシエーション名」と呼びます。

この○○は、モデル名と勘違いしやすいのですが、細かく言うと「アソシエーション名とモデル名に関連性はありません。」

Railsは、○○に設定したアソシエーション名と、同じ名前のテーブルが存在すると「自動的に認識」、○○に設定したアソシエーションとモデルを「自動的に設定」してくれます。
```

**（３）データの取得**

では、（２）で設定したアソシエーションを利用して、製作者鈴木が作成したアプリ情報を取得してみましょう。

`rails c`での実行コマンド
```
producer =  Producer.find(1) #製作者鈴木の情報を取得
producer.apps                #鈴木が作成したアプリ情報全てを取得
```

### 小課題

ここからは、小課題に取り組んでいただきます。
小課題は課題として提出する必要はありませんが、必ず一度手を動かして取り組んでみてください！

小課題の解答例は、このテキストの一番最後に記載しています。


#### 課題の内容

テキストの例で、

`DICアプリを作成した製作者情報を取得したい場合`

どういうコードを実行すればいいでしょうか。

#### 質問について

質問はこちらのURLにお願いいたします。

https://diveintocode.jp/diver/questions/new

## テキストフィードバックについて

今後のDIVE INTO CODEの発展のために、お時間があれば
フィードバックのご協力をお願い致します。
以下を参考に、DIVERのコメント欄にご投稿して頂けると有難いです。

・テキストの難易度は適切であったか

・テキストの分量は適切であったか

・説明していない用語はなかったか

・テキストに間違いはなかったか

・テキストのゴールに対して適切な内容であったか

・他に説明を加えてほしいことは無かったか

・やってて楽しいテキストであったか

・有益なテキストであったか

**その他なんでもご意見をご投稿ください**

**DIVER質問機能のコメント欄に記述をお願い致します。**

#### 小課題の解答例

```
app = App.where(name: “DIC”)
app.user
```
